<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Generate countdown gifs</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <style>
        body {
            width: 100%;
            background: rgb(108,117,125);
            background: linear-gradient(90deg, rgba(108,117,125,1) 50%, rgba(33,37,41,1) 50%);
        }
    </style>
    <script>
        function getTimeFormated(time) {
            const year = time.getFullYear()
            const day = ("0" + time.getDate()).slice(-2);
            const month = ("0" + (time.getMonth() + 1)).slice(-2);
            const hours = ("0" + (time.getHours() + 1)).slice(-2);
            const minutes = ("0" + (time.getMinutes() + 1)).slice(-2);
            const seconds = ("0" + (time.getSeconds() + 1)).slice(-2);
            return `${year}-${month}-${day}T${hours}:${minutes}:${seconds}`
        }
        function setInitialValues() {
            const expireText = "Event Time Eneded";

            const backgroundColor = "#ffffff";
            const textColor = "#363636";
            const strokeColor = "#DFE4EA";

            const timeFontSize = "60";
            const textFontSize = "14";
            const expireRextFontSize = "40";

            const frame = "180";

            let eventDate = new Date();
            eventDate.setDate(eventDate.getDate() + 20);

            $("input#event-date").val(getTimeFormated(eventDate));

            $("input#expire-text").val(expireText);

            $("input#bg-color").val(backgroundColor);
            $("input#text-color").val(textColor);
            $("input#stroke-color").val(strokeColor);

            $("input#time-font-size").val(timeFontSize);
            $("input#text-font-size").val(textFontSize);
            $("input#expire-text-font-size").val(expireRextFontSize);

            $("input#frame").val(frame);
            onFieldChange()
        }
        $(document).ready(function () {
            setInitialValues();
        });

        function onFieldChange() {
            $("#result-container").hide();
            $("#image-container").html('<div class="spinner-border text-primary"></div>')

            const eventTime = $("input#event-date").val();
            const expiredText = $("input#expire-text").val();
            const backgroundColor = $("input#bg-color").val().replace("#", "");
            const textColor = $("input#text-color").val().replace("#", "");
            const strokeColor = $("input#stroke-color").val().replace("#", "");
            const timeFontSize = $("input#time-font-size").val();
            const textFontSize = $("input#text-font-size").val();
            const expireRextFontSize = $("input#expire-text-font-size").val();
            const frame = $("input#frame").val();

            let queryParams = `name=eventGif`;
            queryParams = `${queryParams}&expiredText=${expiredText}`;
            queryParams = `${queryParams}&bg=${backgroundColor}`;
            queryParams = `${queryParams}&color=${textColor}`;
            queryParams = `${queryParams}&strokColor=${strokeColor}`;
            queryParams = `${queryParams}&timeFontSize=${timeFontSize}`;
            queryParams = `${queryParams}&timeWordsFontSize=${textFontSize}`;
            queryParams = `${queryParams}&experiedTextFontSize=${expireRextFontSize}`;
            queryParams = `${queryParams}&frames=${frame}`;
            queryParams = `${queryParams}&time=${getTimeFormated(new Date(eventTime))}`;
            const finalURL = `${window.location.origin}/generate?${queryParams}`;
            $("#image-container").html(`<img src="${finalURL}" id="generated-gif"/>`);

            $("input#embed-code").val(`<img src="${finalURL}" width="390" height="140"/>`)

            $("#result-container").show();
        }
        function copyEmbedCode() {
            navigator.clipboard.writeText($("input#embed-code").val());
        }
    </script>
</head>

<body>
    <div class="text-center text-light heading mt-2">
        <h1><span class="text-dark">Countown</span> <span class="text-secondary">Generator</span></h1>
    </div>
    <div class="row m-0" style="width: 100%">
        <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 col-xs-12 bg-secondary text-light">
            <div class="pt-5 pb-5 px-4">
                <div class="mb-3 mt-3">
                    <label for="event-date" class="form-label">Event Date:</label>
                    <input type="datetime-local" class="form-control" id="event-date" onchange="onFieldChange()">
                </div>
                <div class="mb-3 mt-3">
                    <label for="expire-text" class="form-label">Expire Text:</label>
                    <input type="text" class="form-control" id="expire-text" onchange="onFieldChange()">
                </div>
                <fieldset class="mb-3 mt-3">
                    <legend>Color</legend>
                    <div class="row">
                        <div class="col-lg-4 col-md-6 col-sm-4 col-xs-4">
                            <div class="">
                                <label for="bg-color" class="form-label">Background Color:</label>
                                <input type="color" class="form-control" id="bg-color" onchange="onFieldChange()">
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6 col-sm-4 col-xs-4">
                            <div class="">
                                <label for="text-color" class="form-label">Text Color:</label>
                                <input type="color" class="form-control" id="text-color" onchange="onFieldChange()">
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6 col-sm-4 col-xs-4">
                            <div class="">
                                <label for="stroke-color" class="form-label">Line Color:</label>
                                <input type="color" class="form-control" id="stroke-color" onchange="onFieldChange()">
                            </div>
                        </div>
                    </div>
                </fieldset>
                <div id="accordion" class="mt-5">
                    <div class="card bg-secondary text-light border">
                        <div class="card-header">
                            <a class="btn text-light" data-bs-toggle="collapse" href="#collapseOne">
                                Advanced >
                            </a>
                        </div>
                        <div id="collapseOne" class="collapse" data-bs-parent="#accordion">
                            <div class="card-body bg-secondary">
                                <fieldset class="mb-3 mt-3">
                                    <legend>Font</legend>
                                    <div class="row">
                                        <div class="col-lg-4 col-md-6 col-sm-4 col-xs-4">
                                            <div class="">
                                                <label for="time-font-size" class="form-label">Time Font Size:</label>
                                                <div class="input-group mb-3">
                                                    <input type="number" class="form-control" min="1" max="80" id="time-font-size"
                                                        onchange="onFieldChange()">
                                                    <span class="input-group-text">px</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-4 col-md-6 col-sm-4 col-xs-4">
                                            <div class="">
                                                <label for="text-font-size" class="form-label">Text Font Size:</label>
                                                <div class="input-group mb-3">
                                                    <input type="number" class="form-control" min="1" max="25" id="text-font-size"
                                                        onchange="onFieldChange()">
                                                    <span class="input-group-text">px</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-4 col-md-6 col-sm-4 col-xs-4">
                                            <div class="">
                                                <label for="expire-text-font-size" class="form-label">Expire Text Font Size:</label>
                                                <div class="input-group mb-3">
                                                    <input type="number" class="form-control" min="1" max="100"
                                                        id="expire-text-font-size" onchange="onFieldChange()">
                                                    <span class="input-group-text">px</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                                <div class="mb-3 mt-3">
                                    <label for="frame" class="form-label">Frames:</label>
                                    <input type="number" class="form-control" id="frame" min="1" max="300" onchange="onFieldChange()">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 col-xs-12 bg-dark text-light">
            <div class="pt-5 pb-5 px-4" id="result-container">
                <div class="d-flex justify-content-center pt-0 pt-lg-5 pt-md-5" id="image-container">
                    <img src="" id="generated-gif" />
                </div>
                <div class="d-flex justify-content-center flex-column pt-0 pt-lg-5 pt-md-5 mt-5">
                    <label for="frame" class="embed-code">Embed Code:</label>
                    <div class="input-group mb-3 mt-1">
                        <input type="text" class="form-control" id="embed-code" disabled>
                        <button class="btn btn-secondary" onclick="copyEmbedCode()">Copy</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>